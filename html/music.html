<!DOCTYPE html>
<html>
<head>
	<title>music</title>
    <meta charset="utf-8">
</head>
<script type="text/javascript">
	window.onload=function(){	
		
		var canvas = document.querySelector("canvas");
        drawcanvas()
		var a=setInterval("drawcanvas()",2000);
		canvas.onclick=function(){//给canvas添加点击事件
			var timer;
    		if (a) {
    			clearInterval(a);
				 a=null;
    		} else{ 
    			 a=setInterval("drawcanvas()",2000);
    		}
        }  

        audio = document.getElementsByTagName('audio'),
            //显示歌词的元素
            lyricContainer = document.getElementById('lyricContainer');
            //监听ontimeupdate事件
         
         var text="[ti:Love The Way You Lie]\n[ar:Eminem]\n[al:Grammy Nominees 2011]\n[by:]\n[offset:0]\n[00:00.10]Love The Way You Lie - Eminem/Rihanna\n[00:00.20]Written by：Marshall Mathers/Alexander Grant/Holly Hafermann\n[00:00.40]Just gonna stand there and watch me burn\n[00:04.54]\n[00:05.73]But that's alright because I like the way it hurts\n[00:10.47]\n[00:11.53]Just gonna stand there and hear me cry\n[00:15.66]\n[00:16.82]But that's alright because I love the way you lie\n[00:21.45]\n[00:22.22]I love the way you lie\n[00:24.21]\n[00:25.37]I can't tell you what it really is\n[00:27.09]I can only tell you what it feels like\n[00:29.24]And right now it's a still night in my windpipe\n[00:32.01]I can't breathe but I still fight while I can fight\n[00:34.78]As long as the wrong feels right it's like I'm in flight\n[00:37.66]High off the law drunk from my hate\n[00:39.57]It's like I'm huffin' paint and I love it the more I suffer I suffocate\n[00:43.22]And right before I'm about to drown she resuscitates me she f**kin' hates me\n[00:47.67]And I love it wait where you goin'\n[00:49.54]I'm leavin' you no you ain't come back\n[00:52.02]We're runnin' right back here we go again\n[00:54.08]So insane cause when it's goin' good it's goin' great\n[00:56.91]I'm superman with the wind in his back she's always  Lane\n[00:59.68]But when it's bad it's awful I feel so ashamed I snap\n[01:02.94]Whose that dude I don't even know his name\n[01:05.28]I laid hands on her\n[01:06.34]I never stoop so low again\n[01:07.85]I guess I don't know my own strength\n[01:09.76]Just gonna stand there and watch me burn\n[01:13.96]\n[01:14.70]But that's alright because I like the way it hurts\n[01:19.36]\n[01:20.67]Just gonna stand there and hear me cry\n[01:24.95]\n[01:25.69]But that's alright because I love the way you lie\n[01:30.49]\n[01:31.23]I love the way you lie I love the way you lie\n[01:38.90]\n[01:43.03]You ever love somebody so much you can barely breathe\n[01:45.58]When you with em you meet and neither one of you even know what hit em\n[01:49.00]Got that warm fuzzy feeling\n[01:50.22]Yeah them chills used to get em\n[01:51.87]Now you're getting f**kin' sick of lookin' at em\n[01:54.06]You swore you'd never hit em never do nothin' to hurt em\n[01:56.67]Now you're in each other's face spewin' venom in your words when you spit em\n[02:00.22]You push pull each other's hair\n[02:01.61]Scratch pop hit em throw em down pin em\n[02:03.82]So lost in the moments when you're in em\n[02:05.67]It's the rage that took over it controls you both\n[02:07.89]So they say it's best to go your seperate ways\n[02:09.87]Guess that they don't know ya\n[02:11.23]Cause today that was yesterday\n[02:12.61]Yesterday is over it's a different day\n[02:14.73]Sound like broken records playin' over\n[02:16.42]But you promised her next time you'll show restraint\n[02:18.88]You don't get another chance\n[02:20.35]Life is no nintendo game\n[02:21.76]But you lied again\n[02:22.75]Now you get to watch her leave out the window\n[02:24.76]Guess that's why they call it window pane\n[02:26.95]Just gonna stand there and watch me burn\n[02:31.07]\n[02:31.95]But that's alright because I like the way it hurts\n[02:37.05]\n[02:37.96]Just gonna stand there and hear me cry\n[02:42.06]\n[02:42.97]But that's alright because I love the way you lie\n[02:47.75]\n[02:48.48]I love the way you lie I love the way you lie\n[02:56.20]\n[03:00.42]Now I know we said things did things that we didn't mean\n[03:03.41]And we fall back into the same patterns same routine\n[03:06.62]But your temper's just as bad as mine is you're the same as me\n[03:09.46]When it comes to love you're just as blinded\n[03:11.41]Baby please come back it wasn't you baby it was me\n[03:14.56]Maybe our relationship isn't as crazy as it seems\n[03:17.25]Maybe that's what happens when a tornado meets a volcano\n[03:20.32]All I know is I love you too much to walk away though\n[03:23.11]Come inside pick up the bags off the sidewalk\n[03:25.77]Don't you hear sincerity in my voice when I talk\n[03:28.55]Told you this is my fault look me in the eyeball\n[03:31.36]Next time I'm pissed I'll aim my fist at the drywall\n[03:34.22]Next time there won't be no next time\n[03:36.18]I apologize even though I know it's lies\n[03:38.63]I'm tired of the games I just want her back\n[03:40.94]I know I'm a liar if she ever tries to f**kin' leave again\n[03:44.12]I'm a tie her to the bed and set this house on fire\n[03:46.91]Just gonna stand there and watch me burn\n[03:51.02]\n[03:51.96]But that's alright because I like the way it hurts\n[03:57.09]\n[03:57.91]Just gonna stand there and hear me cry\n[04:02.13]\n[04:02.83]But that's alright because I love the way you lie\n[04:07.83]\n[04:08.50]I love the way you lie\n[04:10.53]\n[04:13.81]I love the way you lie\n"
         lyric=parseLyric(text);

	}


    function myFunction(e){
        var lrc=document.querySelector("p");
        lrc.innerHTML=lyric[0][1]; 
        //遍历所有歌词，看哪句歌词的时间与当然时间吻合    
            for (var i = 0, l = lyric.length; i < l; i++) {
                if (e.currentTime /*当前播放的时间*/ > lyric[i][0]) {
                    //显示到页面
                    lyricContainer.textContent = lyric[i][1];
                };
            };
    }

	function drawcanvas(){		
        var canvas = document.querySelector("canvas");
        var context = canvas.getContext('2d');
        var r, cx, cy, radgrad;
        var drawCircles = function() {
      // fade existing content
      context.fillStyle = 'rgba(255,255,255,0.9)';
      context.fillRect(0,0,canvas.width,canvas.height);

      // draw new spheres
      for (var i=0; i<360; i+=15) {
        // define random position and size
        cx = Math.random()*canvas.width;
        cy = Math.random()*canvas.height;
        r = Math.random()*canvas.width/10.0;

        // define radial gradient
        radgrad = context.createRadialGradient(
          0+(r*0.15),0-(r*0.25),
          r/3.0,0,0,r
        );
        radgrad.addColorStop(0.0, 'hsl('+i+',100%,75%)');
        radgrad.addColorStop(0.9, 'hsl('+i+',100%,50%)');
        radgrad.addColorStop(1.0, 'rgba(0,0,0,0)');

        // draw circle
        context.save();
        context.translate(cx,cy);
        context.beginPath();
        context.moveTo(0+r,0);
        context.arc(0,0,r,0,Math.PI*2.0,0);
        context.fillStyle = radgrad;
        context.fill();
        context.restore();
      } 
        };
        drawCircles();
	}

    function parseLyric(text) {
        //get each line from the text
        var lines = text.split('\n'),
            //this regex mathes the time [00.12.78]
            pattern = /\[\d{2}:\d{2}.\d{2}\]/g,
            result = [];

        // Get offset from lyrics
        // var offset = this.getOffset(text);

        //exclude the description parts or empty parts of the lyric
        while (!pattern.test(lines[0])) {
            lines = lines.slice(1);
        };
        //remove the last empty item
        lines[lines.length - 1].length === 0 && lines.pop();
        //display all content on the page
        lines.forEach(function(v, i, a) {
            var time = v.match(pattern),
                value = v.replace(pattern, '');
            time.forEach(function(v1, i1, a1) {
                //convert the [min:sec] to secs format then store into result
                var t = v1.slice(1, -1).split(':');
                result.push([parseInt(t[0], 10) * 60 + parseFloat(t[1]) , value]);
            });
        });
        //sort the result by time
        result.sort(function(a, b) {
            return a[0] - b[0];
        });
        console.log(result[1][1],result[1][0]);
        return result;
    }
    
 




</script>
<style type="text/css">
	html,body{  
                height:100%;  
                width:100%;  
                text-align: center;
            } 
	#canvas{
		 display:block; 
		 height: 100%;
		 width: auto;
         z-index: -1;
	}
    /*#lyricWrapper{
         float:left;
    }*/
    #songname{
        width: 100%;
        text-align: center;
        z-index: 98;
        position: fixed;
        top: 15px;
        font-size: medium;

    }

    #player {
        position: fixed;
        bottom: 15px;
        opacity: 1;
        left: 0;
        right: 0;
        width: 100%;
        height: 0%;
        overflow: visible;
    }
    /*#player:hover {
        opacity: 1;
    }*/
    #lyricContainer{
        
        width: 100%;
        height: 20%;
        text-align: center;
        z-index: 98;
        position: fixed;
        top: 25%;

        word-wrap: break-word;
        font: bold 20px arial,sans-serif;
    }
</style>
<body>	
	<canvas id="canvas" ></canvas>
    <div>
    <div id="songname"><p></p></div>
    <div id="lyricContainer"><p></p></div>
    </div>
    <div id="player"> 
        <audio id="audio" preload="auto" controls="controls" loop="loop" ontimeupdate="myFunction(this)">
            <source src="../music/Eminem - Love The Way You Lie.mp3" type="audio/mpeg"> 
            <source src="../music/Grande.mp3" type="audio/mpeg"> 
            Please change your browser!
        </audio>
        
    </div>
</body>
</html>


